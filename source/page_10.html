<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns:o = 
"urn:schemas-microsoft-com:office:office"><HEAD><title>编译升级镜像</title>
<META content="text/html; charset=UTF-8" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 11.00.9600.17728"><LINK rel=stylesheet 
href="_template.css"></HEAD>
<BODY>
<BLOCKQUOTE style="MARGIN-RIGHT: 0px" dir=ltr>
<P><FONT size=2>一、MTK Android 5.0/5.1 
Lollipop版本镜像编译方法</FONT>   </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>在MTK平台最新的Android系统源码环境中，编译方式与Android原生设计并无太大差异</FONT></P>
<P><FONT size=2>Build the Code</FONT>  </P>
<P><FONT size=2>Build everything with make. GNU make can 
handle parallel tasks with a -jN argument, and it's common to use a number of 
tasks N that's between 1 and 2 times the number of hardware threads on the 
computer being used for the build. For example, on a dual-E5520 machine (2 CPUs, 
4 cores per CPU, 2 threads per core), the fastest builds are made with commands 
between make -j16 and make -j32.</FONT>         
                
               
                
             
  </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>常用编译命令参考：</FONT></P>
<P><FONT size=2>
  <TABLE style="WIDTH: 700px; BORDER-COLLAPSE: collapse; HEIGHT: 38px" border=1 
  cellSpacing=0 borderColor=#000000 cellPadding=2 width=700 bgColor=#efefef 
  >
    
    <TR>
      <TD><FONT size=2 ></FONT></TD></TR></TABLE></FONT></P>
<P><FONT size=2>$ make -j16 (完整编译系统并生成全部镜像)</FONT>   </P>
<P>
  <TABLE style="WIDTH: 700px; BORDER-COLLAPSE: collapse; HEIGHT: 38px" border=1 
  cellSpacing=0 borderColor=#000000 cellPadding=2 width=700 bgColor=#efefef 
  >
    
    <TR>
      <TD><FONT size=2 ></FONT></TD></TR></TABLE>   </P>
<P><FONT size=2>$ make pl -j16 
(编译preloader并生成preloader_xxx.bin)</FONT>    </P>
<P>
  <TABLE style="WIDTH: 700px; BORDER-COLLAPSE: collapse; HEIGHT: 38px" border=1 
  cellSpacing=0 borderColor=#000000 cellPadding=2 width=700 bgColor=#efefef 
  >
    
    <TR>
      <TD><FONT size=2 ></FONT></TD></TR></TABLE>    </P>
<P><FONT size=2>$ make lk&nbsp; -j16 
(编译lk并生成lk.bin及logo.bin)</FONT>    </P>
<P><FONT size=2>$ make bootimage -j16 
(编译kernel并生成boot.img)</FONT>    </P>
<P><FONT size=2>$ make recoveryimage -j16 
(编译kernel并生成recovery.img)</FONT>    </P>
<P><FONT size=2>$ make systemimage -j16 
(编译Android系统并生成system..img)</FONT>    </P>
<P><FONT size=2>$ make otapackage -j16 (生成target 
file及OTA升级包)</FONT>     </P>
<P><FONT size=2>$ make clean (清除所有的编译结果)</FONT>   </P>
<P><FONT size=2>$ make update-api 
(添加、删除或修改系统API后重新生成current.xml)</FONT>   </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>二、MTK Android 4.4 Kitkat版本镜像编译方法</FONT>   </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>全新编译RCT6773W22机型全部镜像user版本</FONT></P>
<P><FONT size=2> $./mk-o=TARGET_BUILD_VARIANT=user 
RCT6773W22 n</FONT>  </P>
<P><BR><FONT size=2>继续编译RCT6773W22机型全部镜像，此命令在上次编译中断或已经编译完成后继续修改代码再次编译时可以更快完成编译</FONT></P>
<P><FONT size= 2>&nbsp;$./mk-o=TARGET_BUILD_VARIANT=user 
RCT6773W22&nbsp; r</FONT> 
 </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>编译eng版本所有镜像</FONT></P>
<P><FONT size=2>$ ./mk&nbsp; RCT6773W22 n</FONT>   </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>编译时添加-t参数可以控制编译系统输出打印信息</FONT></P>
<P><FONT size=2>$ ./mk&nbsp; -t RCT6773W22 n</FONT>    </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>编译preloader</FONT></P>
<P><FONT size=2>$ ./mk&nbsp; -t RCT6773W22 n pl</FONT>     </P>
<P><FONT size=2>编译lk</FONT></P>
<P><FONT size=2>$ ./mk&nbsp; -t RCT6773W22 n lk</FONT>     </P>
<P><FONT size=2>编译bootimage</FONT></P>
<P><FONT size=2>编译system.img</FONT></P>
<P><FONT size=2>打包system.img</FONT></P>
<P><FONT size=2>编译OTA升级包及target file</FONT> </P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>更多编译参数请查看mk命令的帮助内容：</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>ptions:<BR>&nbsp; -t, -tee&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Print log information on the standard-out.<BR>&nbsp; -o, 
-opt=bypass_argument_to_make<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Pass extra arguments to make.</FONT> 
     </P>
<P><FONT size=2>&nbsp; -h, -help&nbsp;&nbsp;&nbsp;&nbsp; : 
Print this message and exit.</FONT>      
  </P>
<P><FONT size=2>Projects:<BR>&nbsp; 
one of available projects.</FONT>    </P>
<P><FONT size=2>Actions:<BR>&nbsp; listp, 
listproject<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: List all available projects.</FONT> 
    </P>
<P><FONT size=2>&nbsp; check-env&nbsp;&nbsp;&nbsp;&nbsp; : Check if 
build environment is ready.<BR>&nbsp; check-dep&nbsp;&nbsp;&nbsp;&nbsp; : Check 
feature dependency.<BR>&nbsp; n, new&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 
Clean and perform a full build.<BR>&nbsp; c, clean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Clean the immediate files(such as, objects, libraries etc.).<BR>&nbsp; r, 
remake&nbsp;&nbsp;&nbsp;&nbsp; : Rebuild(target will be updated if any 
dependency updats).<BR>&nbsp; mrproper&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Remove 
all generated files + config + various backup files in Kbuild process.<BR>&nbsp; 
bm_new&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : "new" + GNU make's "-k"(keep 
going when encounter error) feature.<BR>&nbsp; bm_remake&nbsp;&nbsp;&nbsp;&nbsp; 
: "remake" + GNU make's "-k"(keep going when encounter error) feature.<BR>&nbsp; 
mm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build 
module through Android native command "mm"<BR>&nbsp; 
mma&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build module 
through Android native command "mma"</FONT> 
    
    </P>
<P><FONT size=2>&nbsp; emigen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Generate EMI setting source code.<BR>&nbsp; 
nandgen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate supported NAND flash 
device list.<BR>&nbsp; codegen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate 
trace DB(for META/Cather etc. tools used).<BR>&nbsp; 
drvgen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate driver customization 
source.<BR>&nbsp; custgen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate 
customization source.<BR>&nbsp; javaoptgen&nbsp;&nbsp;&nbsp; : Generate the 
global java options.<BR>&nbsp; 
ptgen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate partition 
setting header &amp; scatter file.<BR>&nbsp; 
bindergen&nbsp;&nbsp;&nbsp;&nbsp; : Generate binder related 
information</FONT>   
   </P>
<P><FONT size=2>&nbsp; sign-image&nbsp;&nbsp;&nbsp; : Sign all the image 
generated.<BR>&nbsp; encrypt-image : Encrypt all the image generated.<BR>&nbsp; 
update-api&nbsp;&nbsp;&nbsp; : Android default build 
action<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(be executed if system setting or anything removed from API).<BR>&nbsp; 
check-modem&nbsp;&nbsp; : Check modem image consistency.<BR>&nbsp; 
upadte-modem&nbsp; : Update modem image located in system.img.<BR>&nbsp; 
modem-info&nbsp;&nbsp;&nbsp; : Show modem version<BR>&nbsp; 
gen-relkey&nbsp;&nbsp;&nbsp; : Generate releasekey for application 
signing.<BR>&nbsp; check-appres&nbsp; : Check unused application 
resource.</FONT>      </P>
<P><FONT size=2>&nbsp; 
sdk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build sdk 
package.<BR>&nbsp; win_sdk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build sdk 
package with a few Windows tools.<BR>&nbsp; banyan_addon&nbsp; : Build MTK sdk 
addon.<BR>&nbsp; banyan_addon_x86 :Build MTK sdk x86 addon.<BR>&nbsp; 
cts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build cts 
package.<BR>&nbsp; bootimage&nbsp;&nbsp;&nbsp;&nbsp; : Build boot 
image(boot.img).<BR>&nbsp; cacheimage&nbsp;&nbsp;&nbsp; : Build cache 
image(cache.img).<BR>&nbsp; systemimage&nbsp;&nbsp; : Build system 
image(system.img).<BR>&nbsp; 
snod&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build system image 
without 
dependency.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(that is, ONLY pack the system image, NOT checking its dependencies.)<BR>&nbsp; 
recoveryimage : Build recovery image(recovery.img).<BR>&nbsp; 
secroimage&nbsp;&nbsp;&nbsp; : Build secro image(secro.img).<BR>&nbsp; 
factoryimage&nbsp; : Build factory image(factory.img).<BR>&nbsp; userdataimage : 
Build userdata image(userdata.img).<BR>&nbsp; 
userdataimage-nodeps<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Build userdata image without 
dependency.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(that is, ONLY pack the userdata image, NOT checking its 
dependencies.)<BR>&nbsp; dump-products : Dump products related 
configuration(PRODUCT_PACKAGE,PRODUCT_NAME ect.)<BR>&nbsp; 
target-files-package<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Build the target files 
package.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(A zip of the directories that map to the target 
filesystem.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
This zip can be used to create an OTA package or filesystem 
image<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
as a post-build step.)<BR>&nbsp; updatepackage : Build the update 
package.<BR>&nbsp; 
dist&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Build distribution 
package.</FONT>   
  </P>
<P><FONT size=2>Modules:<BR>&nbsp; pl, preloader : Specify to build 
preloader.<BR>&nbsp; 
lk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Specify 
to build little kernel.<BR>&nbsp; 
md32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Specify to build 
DSP md32.<BR>&nbsp; tz, trustzone : Specify to build trusted execution 
environment.<BR>&nbsp; k,&nbsp; kernel&nbsp;&nbsp;&nbsp; : Specify to build 
kernel.<BR>&nbsp; dr, android&nbsp;&nbsp; : Specify to build android.<BR>&nbsp; 
NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Specify to build 
all components/modules in default.<BR>&nbsp; k &lt;module 
path&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Specify to build kernel component/module with the source path.<BR>&nbsp; dr 
&lt;module 
name&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Specify to build android component/module with module name.</FONT> 
        </P>
<P><FONT size=2>Other tools:<BR>&nbsp; 
prebuilts/misc/linux-x86/ccache/ccache -M 
10G<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Set CCACHE pool size to 10GB</FONT> 
      </P>
<P><FONT size=2>Example:<BR>&nbsp; ./mk -t e1k 
emigen<BR> 
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Generate EMIsettingsourcecode.&lt;BR&gt;&nbsp;./mk-o=TARGET_BUILD_VARIANT=user 
e1k 
n<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Start a user mode full build.<BR>&nbsp; ./mk listp&nbsp;&nbsp;&nbsp; : List 
all available projects.<BR>&nbsp; ./mk e1k 
bootimage<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Build bootimage for e1k project.<BR>&nbsp; ./mk e1k bm_new 
k<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Build kernel for e1k project.<BR>&nbsp; ./makeMtk e1k c,bm_remake pl 
k<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Clean &amp; Build preloader and kernel for e1k project. <BR>&nbsp; ./makeMtk 
e1k n k 
kernel/xxx/xxx<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Build(full build) kernel component/module 
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
under the path "kernel/xxx/xxx" for e1k project.<BR>&nbsp; ./makeMtk e1k r dr 
Gallery<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Rebuild android module named Gallery for e1k project.<BR>&nbsp; ./makeMtk e1k 
mm packages/apps/Settings<BR>&nbsp;&nbsp;&nbsp; : Change Directory to 
packages/apps/Settings and execute "mm"<BR>&nbsp; ./makeMtk e1k mma 
packages/apps/Settings<BR>&nbsp;&nbsp;&nbsp; : Change Directory to 
packages/apps/Settings and execute "mma"<BR></FONT></P></BLOCKQUOTE></BODY></HTML>
